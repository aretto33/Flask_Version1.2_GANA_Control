{% extends "base.html" %}
{% block content %}

<style>

    /* Banner */
    .banner {
        width: 100%;
        max-width: 1300px;
        height: auto;
        display: block;
        margin: 20px auto;
        border-radius: 12px;
    }

    .contenido {
        max-width: 1000px;
        margin: auto;
    }

    /* === Estilos Botones Café 3D === */
    .btn-cafe {
        display: block;
        background: #c7a97a;
        padding: 12px;
        margin: 10px 0;
        text-align: center;
        text-decoration: none;
        font-weight: bold;
        color: #4b3621;
        border-radius: 10px;
        border-bottom: 4px solid #9b7b54;
        box-shadow: 0px 4px 0px #8b6b47;
        transition: 0.1s;
    }

    .btn-cafe:active {
        transform: translateY(2px);
        box-shadow: 0px 2px 0px #8b6b47;
        border-bottom: 2px solid #9b7b54;
    }

    /* Botón especial MIS DATOS */
    .btn-datos {
        display: block;
        background: #eed9b6;
        padding: 14px;
        text-align: center;
        text-decoration: none;
        font-weight: bold;
        color: #5c432a;
        border-radius: 12px;
        border-bottom: 5px solid #c4a076;
        box-shadow: 0px 5px 0px #a58563;
        margin: 20px 0 30px 0;
        transition: 0.1s;
    }

    .btn-datos:active {
        transform: translateY(3px);
        box-shadow: 0px 2px 0px #a58563;
        border-bottom: 2px solid #c4a076;
    }

    /* === Mini juego === */
    #game-area {
        width: 100%;
        height: 250px;
        background: #dff5d0;
        border: 2px solid #7a9e6f;
        border-radius: 12px;
        position: relative;
        overflow: hidden;
        margin-top: 30px;
    }

    #cow {
        width: 70px;
        height: 70px;
        position: absolute;
        top: 90px;
        left: 10px;
        transition: top 0.1s;
    }

    .obstacle {
        width: 40px;
        height: 80px;
        background: brown;
        position: absolute;
        right: -50px;
        top: 120px;
        animation: moveObstacle 2.8s linear infinite;
        border-radius: 8px;
    }

    @keyframes moveObstacle {
        0% { right: -50px; }
        100% { right: 100%; }
    }

    #score {
        font-size: 1.3rem;
        font-weight: bold;
        margin-top: 10px;
        text-align: center;
    }

    /* Sidebar */
    .sidebar {
        width: 230px;
        padding: 15px;
    }

    .dashboard {
        display: flex;
    }

    /* Modal / overlay para datos del animal */
    .busqueda-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.45); display:none; align-items:center; justify-content:center; z-index:9999; }
    .busqueda-card { background:#fff; width:90%; max-width:640px; border-radius:10px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,0.2); }
    .busqueda-card .close-btn { float:right; background:transparent; border:none; font-size:1.2rem; cursor:pointer; }
    .busqueda-card p{ margin:8px 0 }

</style>


<div class="dashboard">

    <!-- ===== PANEL LATERAL ===== -->
    <div class="sidebar">

        <!-- Botón MIS DATOS separado -->
        <a href="{{ url_for('mi_productor') }}" class="btn-datos">Mis Datos</a>

        {% if view == 'veterinario' or rol == 'Veterinario' %}
            <!-- Menú para Veterinario -->
            <a href="{{ url_for('pesajes') }}" class="btn-cafe">Pesaje</a>
            <a href="{{ url_for('seguimiento') }}" class="btn-cafe">Seguimiento Vet</a>
            <a href="{{ url_for('razas') }}" class="btn-cafe">Razas</a>
        {% elif view == 'comprador' or rol == 'Comprador' %}
            <!-- Menú para Comprador -->
            <a href="{{ url_for('tabla_precio') }}" class="btn-cafe">Tabla de Precios</a>
            <a href="{{ url_for('album_razas') }}" class="btn-cafe">Guía de Razas</a>
            <a href="{{ url_for('opiniones') }}" class="btn-cafe">Opiniones</a>
        {% else %}
            <!-- Menú por defecto (Productor/Admin) -->
            <a href="{{ url_for('animales') }}" class="btn-cafe">Animales</a>
            <a href="{{ url_for('predios') }}" class="btn-cafe">Predios</a>
            <a href="{{ url_for('pesajes') }}" class="btn-cafe">Pesaje</a>
            <a href="{{ url_for('registro_siniga') }}" class="btn-cafe">Registro SINIGA</a>
            <a href="{{ url_for('seguimiento') }}" class="btn-cafe">Seg. Veterinario</a>
            <a href="{{ url_for('ventas') }}" class="btn-cafe">Venta</a>
            <a href="{{ url_for('razas') }}" class="btn-cafe">Razas</a>
        {% endif %}

    </div>

    <!-- ===== PANEL CENTRAL ===== -->
    <div class="contenido">

        <h2 class="bienvenido">Bienvenido {{ usuario }} ({{ rol }})</h2>

        <img src="{{ url_for('static', filename='img/banner.png') }}" class="banner">

        {% if view == 'veterinario' or rol == 'Veterinario' %}
            <h1 class="titulo">Panel Veterinario</h1>
            <div class="tramites">
                <a href="{{ url_for('rearetado') }}" class="btn-cafe">Trámites Rearetado</a>
                <a href="{{ url_for('seguimiento') }}" class="btn-cafe">Registrar Seguimiento</a>
                <a href="{{ url_for('pesajes') }}" class="btn-cafe">Registrar Pesaje</a>
            </div>
        {% elif view == 'comprador' or rol == 'Comprador' %}
            <h1 class="titulo">Panel Comprador</h1>
            <div class="tramites">
                <a href="{{ url_for('tabla_precio') }}" class="btn-cafe">Ver Tabla de Precios</a>
                <a href="{{ url_for('album_razas') }}" class="btn-cafe">Guía de Razas</a>
                <a href="{{ url_for('opiniones') }}" class="btn-cafe">Leer Opiniones</a>
            </div>
        {% else %}
            <h1 class="titulo">Trámites</h1>

            <div class="tramites">
                <a href= "{{ url_for('upp') }}" class="btn-cafe">Descargar Inscripción UPP</a>
                <a href="{{ url_for('rearetado') }}"class="btn-cafe">Trámites Rearetado</a>
                <a href="#" class="btn-cafe" onclick="abrirDatosAnimal()">Trámites datos del Animal</a>
            </div>
        {% endif %}

        <div id="datos-animal" class="busqueda-overlay">
            <div class="busqueda-card">
                <button class="close-btn" onclick="closeDetails()">✕</button>
                <h4>PDF datos del animal</h4>
               <form id="datosForm" onsubmit="return false;">
                    <label>No. Arete</label>
                    <input type="text" id="detalle-noarete" placeholder="Ej. MX123456">

                    <label>ID Predio</label>
                    <input type="number" id="detalle-predio" placeholder="Ej. 5">

                    <button type="button" id="btnDescargarPDF" class="btn-cafe" style="margin-top:10px;">
                        Descargar PDF
                    </button>
                </form>

            </div>
        </div>



    </div>
</div>
<script>
/* ==========================
   ABRIR / CERRAR MODAL
========================== */
function abrirDatosAnimal() {
    document.getElementById("datos-animal").style.display = "flex";
}

function closeDetails() {
    document.getElementById("datos-animal").style.display = "none";
}

/* ==========================
   DESCARGA PDF DATOS ANIMAL
========================== */
document.getElementById("btnDescargarPDF").addEventListener("click", function () {

    const arete = document.getElementById("detalle-noarete").value.trim();
    const predio = document.getElementById("detalle-predio").value.trim();

    if (!arete || !predio) {
        alert("Debes ingresar el número de arete y el ID del predio");
        return;
    }

    // Cambiar estado del botón
    this.disabled = true;
    this.textContent = "Generando PDF...";

    // Ruta Flask al PDF (ajusta si no usas blueprint)
    const baseUrl = "{{ url_for('pdf.pdf_animal') }}";

    // Abrir PDF en nueva pestaña
    window.open(
        `${baseUrl}?arete=${encodeURIComponent(arete)}&predio=${predio}`,
        "_blank"
    );

    // Restaurar botón y cerrar modal
    setTimeout(() => {
        closeDetails();
        this.disabled = false;
        this.textContent = "Descargar PDF";

        document.getElementById("detalle-noarete").value = "";
        document.getElementById("detalle-predio").value = "";
    }, 800);
});
</script>
{% endblock %}  